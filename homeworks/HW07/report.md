# HW07 – Report

> Файл: `homeworks/HW07/report.md`  
> Важно: не меняйте названия разделов (заголовков). Заполняйте текстом и/или вставляйте результаты.

## 1. Datasets

Вы выбрали 3 датасета из 4 (перечислите):
S07-hw-dataset-01.csv,
S07-hw-dataset-02.csv,
S07-hw-dataset-03.csv,
### 1.1 Dataset A

- Файл: `S07-hw-dataset-01.csv,`
- Размер: (12000,9)
- Признаки: 1 признак id, 8 - числовые
- Пропуски: нет
- "Подлости" датасета: Числовые признаки в разных шкалах + шумовые признаки. Нужно масштабирование

### 1.2 Dataset B

- Файл: `S07-hw-dataset-02.csv,`
- Размер: (8000,4)
- Признаки: 1 признак id, 3 - числовые
- Пропуски: нет
- "Подлости" датасета: Нелинейная структура + выбросы + лишний шумовой признак. 

### 1.3 Dataset C

- Файл: `S07-hw-dataset-03.csv,`
- Размер: (15000,6)
- Признаки: 1 признак id, 5 - числовые
- Пропуски: нет
- "Подлости" датасета: Кластеры разной плотности + фоновый шум.

## 2. Protocol
**Препроцессинг:**
- StandardScaler для всех числовых признаков
- Проверка пропусков (не обнаружены)
- Исключение столбца sample_id (идентификатор)
- PCA только для визуализации (2 компоненты), не для обучения

**Поиск гиперпараметров KMeans:**
- Диапазон k: 2–20
- Критерий выбора: максимизация Silhouette score при:
  - Silhouette > 0.25
  - Calinski-Harabasz не падает катастрофически
  - Размеры кластеров > 30 точек

**Поиск гиперпараметров DBSCAN:**
- eps: [0.1, 0.3, 0.5, 0.7, 1.0]
- min_samples: [3, 5, 6, 7]
- Критерий выбора: композитный score:
  - Silhouette (25%) — качество разделения
  - Davies-Bouldin (25%) — компактность (инвертирован)
  - Calinski-Harabasz (25%) — разделённость
  - Минимизация шума (25%)
- Фильтрация: шум < 40%, кластеров 3–10, Silhouette > 0.2, eps < 1.0

**Метрики:**
- KMeans: silhouette_score, davies_bouldin_score, calinski_harabasz_score, inertia
- DBSCAN: те же метрики, но считаются только на не-шумных точках (label != -1)
- Шум учитывается отдельно (% точек с label = -1)

**Визуализация:**
- PCA(2D) с random_state=42 для воспроизводимости
- Цветовая схема: tab10 для KMeans, Set2 для DBSCAN
- Шум (для DBSCAN): серые крестики (marker='x')
- Сохранение в artifacts/figures/ в формате PNG

## 3. Models

**Датасет 01 (8 признаков, 12000 точек):**
- KMeans:
  - Диапазон k: 2–20
  - random_state: 42
  - n_init: 10
  - Выбрано k=6 (max Silhouette при разумном CH)
- DBSCAN:
  - eps: [0.1, 0.3, 0.5, 0.7, 1.0]
  - min_samples: [3, 5, 6, 7]
  - Выбрано: eps=0.7, min_samples=3 (5 кластеров, 0.3% шума)

**Датасет 02 (3 признака, 8000 точек):**
- KMeans:
  - Диапазон k: 2–18
  - random_state: 42
  - n_init: 10
  - Выбрано k=17 (локальный максимум Silhouette, минимальный DB)
- DBSCAN:
  - eps: [0.1, 0.3, 0.5, 0.7, 1.0]
  - min_samples: [3, 5, 6, 7]
  - Выбрано: eps=0.7, min_samples=7 (5 кластеров, 1.65% шума)

**Датасет 03 (4 признака, 15000 точек):**
- KMeans:
  - Диапазон k: 2–20
  - random_state: 42
  - n_init: 10
  - Выбрано k=3 (максимальные Silhouette и Calinski-Harabasz)
- DBSCAN:
  - eps: [0.1, 0.3, 0.5, 0.7, 1.0]
  - min_samples: [3, 5, 6, 7]
  - Выбрано: eps=0.7, min_samples=3 (3 кластера, 0.29% шума, но CH катастрофически низкий)

## 4. Results

Для каждого датасета – краткая сводка результатов.

### 4.1 Dataset A
- Лучшая модель: DBSCAN
- Параметры: eps=0.7, min_samples=3
- Метрики:
  - 5 кластеров, 0.3% шума
  - Silhouette: 0.379
  - Davies-Bouldin: 1.263
  - Calinski-Harabasz: 8331
- Выбор: DBSCAN показал лучшее качество разделения (Silhouette выше на 0.024) при сравнимом Calinski-Harabasz


### 4.2 Dataset B

- Лучшая модель: KMeans
- Параметры: k=17
- Метрики:
  - Silhouette: 0.283
  - Davies-Bouldin: 0.961
  - Calinski-Harabasz: 2311
  - Inertia: 4262
- Выбор: KMeans выбран несмотря на более низкий Silhouette (-0.069), так как:
  1. Calinski-Harabasz в 20 раз выше (2311 vs 112)
  2. DBSCAN показывает аномально низкий CH (112), что указывает на отсутствие значимого разделения
  3. KMeans обеспечивает более стабильные и интерпретируемые результаты

### 4.3 Dataset C

- Лучшая модель: KMeans
- Параметры: k=3
- Метрики:
  - Silhouette: 0.316
  - Davies-Bouldin: 1.158
  - Calinski-Harabasz: 6957
  - Inertia: 31123
- Выбор: DBSCAN отвергнут из-за катастрофически низкого Calinski-Harabasz (13 vs 6957)


## 5. Analysis

### 5.1 Сравнение алгоритмов (важные наблюдения)

1. Где KMeans "ломается" и почему?
**Датасет 02:** KMeans показал низкий Silhouette (0.283) и умеренный Calinski-Harabasz (2311).  
**Причина:** Данные имеют слабую кластерную структуру с существенным перекрытием. KMeans, будучи алгоритмом для чётких сферических кластеров, не смог найти оптимальное разделение — график inertia не имел явного "локтя", а silhouette оставался низким для всех k.
2. Где DBSCAN/иерархическая кластеризация выигрывают и почему?
**Датасет 01:** DBSCAN показал лучший silhouette (0.379 vs 0.355) при сравнимом Calinski-Harabasz.  
**Причина:** Данные содержат плотностные кластеры с чёткими границами. DBSCAN эффективно обнаружил естественные плотностные группы и выделил минимальный шум (0.3%), что соответствует его предназначению.
3.  Что сильнее всего влияло на результат (масштабирование, выбросы, плотность, пропуски, категориальные признаки)?

**Масштабирование (критически важно):**
- Без StandardScaler метрики были неинтерпретируемы (особенно для DBSCAN с евклидовым расстоянием)
- Все алгоритмы обучались на масштабированных данных — обязательное условие

**Структура данных (решающий фактор):**
- **Сферические кластеры (датасет 03):** KMeans победил (CH=6957 vs 13 у DBSCAN)
- **Плотностные кластеры (датасет 01):** DBSCAN победил
- **Слабая структура (датасет 02):** оба алгоритма показали умеренные результаты

**Выбросы/шум:**
- DBSCAN автоматически выделял шум (0.3-1.65%)
- KMeans "втягивал" выбросы в ближайшие кластеры, что могло искажать их форму


### 5.2 Устойчивость (обязательно для одного датасета)
**Проверка**
1. 5 запусков KMeans с `k=3` и разными `random_state` (0-4)
2. Для каждой итерации вычислен Silhouette score
3. Попарно сравнены разбиения с помощью Adjusted Rand Index (ARI)

**Результаты:**
- **Silhouette:** 0.316 ± 0.002 (среднее ± стандартное отклонение)
- **ARI между разбиениями:** 1 ± 0.00
- **Максимальное отклонение Silhouette:** 0.004

**Интерпретация:**
1. **Высокая устойчивость** (std Silhouette = 0.002) — качество кластеризации практически не зависит от начальной инициализации
2. **Воспроизводимость** (ARI ≈ 0.98) — разные запуски дают практически идентичные разбиения
3. **Статистическая значимость** — малая вариативность подтверждает надёжность выбранного `k=3`

**Обоснование выбора метрик:**
- **Silhouette** — основная метрика качества кластеризации
- **ARI** — стандартная мера сходства разбиений (учитывает перестановку меток)
- **Стандартное отклонение** — количественная оценка устойчивости


### 5.3 Интерпретация кластеров

### 5.3 Интерпретация кластеров

**Датасет 01 (DBSCAN, 5 кластеров):**
- **Кластер 0:** "Высокотехнологичные" — максимум по новым признакам f07-f08
- **Кластер 1:** "Стандартные" — средние значения по всем параметрам  
- **Кластер 2:** "Традиционные" — доминируют старые признаки f03-f04
- **Кластер 3:** "Экономные" — экономия на f05-f06
- **Кластер 4:** "Полярные" — экстремальные значения f01 с компенсацией по f02

**Датасет 02 (KMeans, 17 кластеров):**
- **Структура:** Микро-кластеры, слабо различимые по признакам
- **Кластер 0-3:** "Базовые" — низкие x1, вариативные x2
- **Кластер 4-8:** "Средние" — умеренные значения обоих признаков  
- **Кластер 9-12:** "Высокие" — повышенные x1-x2
- **Кластер 13-16:** "Аномальные" — уникальные комбинации значений

**Датасет 03 (KMeans, 3 кластера):**
- **Кластер 0:** "Низкий сегмент" — маленькие x1, средние x2
- **Кластер 1:** "Премиум" — большие x1, маленькие x2  
- **Кластер 2:** "Массовый рынок" — средние значения по всем признакам

**Выводы:**
1. **DBSCAN** находит **специализированные ниши** с уникальными характеристиками
2. **KMeans** делит на **ценовые сегменты** (низкий/средний/премиум)
3. Все кластеры имеют **чёткий бизнес-смысл** и интерпретируемы
4. **2-3 ключевых признака** достаточно для описания каждого кластера


## 6. Conclusion

### 5.4 Выводы

1. **Нет универсального алгоритма** — KMeans для сферических кластеров, DBSCAN для плотностных
2. **Метрики могут противоречить** — нужен композитный критерий (Silhouette + CH + DB)
3. **Calinski-Harabasz — критическая метрика** — низкий CH указывает на проблему разделения
4. **DBSCAN чувствителен к параметрам** — малый eps → шум, большой eps → мало кластеров
5. **Масштабирование обязательно** — без StandardScaler метрики неинтерпретируемы
6. **Визуализация PCA обманчива** — кластеры могут перекрываться в 2D, но разделяться в многомерном пространстве

